{% extends 'base.html.twig' %}

{% block title %}{{ 'sessions.page_title'|trans }}{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('assets/css/style.css') }}">
{% endblock %}

{% block body %}
    <div class="parcours-page">
        <div class="parcours-header">
            <h1>{{ 'courses.title'|trans }}</h1>
            <div class="parcours-header-actions">
            </div>
        </div>

        <div class="table-container">
            <table class="courses-table" id="coursesTable">
                <thead>
                    <tr>
                        <th>{{ 'courses.table.name'|trans }}</th>
                        <th>{{ 'courses.table.parcours'|trans }}</th>
                        <th>{{ 'courses.table.nb_participants'|trans }}</th>
                        <th>{{ 'courses.table.start_date'|trans }}</th>
                        <th>{{ 'courses.table.end_date'|trans }}</th>
                        <th>{{ 'courses.table.actions'|trans }}</th>
                    </tr>
                </thead>
                <tbody id="courseList">
                    {% if sessions|length > 0 %}
                        {% for session in sessions %}
                            {% include 'sessions/tile/session.html.twig' with { 'session': session } %}
                        {% endfor %}
                    {% endif %}
                </tbody>
            </table>
            
            <div class="table-footer">
                <div class="pagination-info">
                    {{ 'courses.table.max_per_page'|trans }}
                    <select id="itemsPerPage" onchange="changeItemsPerPage()">
                        <option value="8">8</option>
                        <option value="15">15</option>
                        <option value="25">25</option>
                        <option value="50">50</option>
                    </select>
                </div>
                <div class="pagination" id="pagination"></div>
            </div>
        </div>
    </div>


    {% block javascripts %}
        <script>
            // Delete session function
            async function deleteSession(sessionId, sessionName) {
                if (!confirm(`{{ 'sessions.delete.confirm'|trans }}: ${sessionName}?`)) {
                    return;
                }

                try {
                    const response = await fetch(`/sessions/${sessionId}/delete`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    });

                    if (response.ok) {
                        // Reload the page to show updated list
                        window.location.reload();
                    } else {
                        const error = await response.json();
                        alert('{{ 'courses.delete.error'|trans }}: ' + (error.message || '{{ 'courses.delete.failed'|trans }}'));
                    }
                } catch (error) {
                    console.error('Error deleting session:', error);
                    alert('{{ 'courses.delete.failed'|trans }}');
                }
            }

            // Change items per page (placeholder)
            function changeItemsPerPage() {
                // TODO: Implement pagination
                console.log('Items per page changed');
            }
        </script>
    {% endblock %}
{% endblock %}
