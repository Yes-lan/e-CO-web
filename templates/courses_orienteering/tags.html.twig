{% extends 'base.html.twig' %}

{% block title %}{{ 'parcours.page_title'|trans }}{% endblock %}

{% block stylesheets %}
{% endblock %}

{% block body %}
<div class="modal-content modal-large">
        <!-- TODO: make the close button work -->
        <span class="close" onclick="closeQRModal()">√ó</span>
        <h2>üî≤ {{ 'parcours.qr_codes_title'|trans }}</h2>
        
        <!-- Important information about QR code stability -->
        <div style="background: #e7f3ff; border-left: 4px solid #2196F3; padding: 1rem; margin-bottom: 1rem; border-radius: 4px;">
            <p style="margin: 0; color: #0c5460; font-weight: 600;">
                ‚ÑπÔ∏è <strong>{{ 'parcours.qr_important'|trans }}</strong> {{ 'parcours.qr_permanent'|trans }}
            </p>
            <p style="margin: 0.5rem 0 0 0; color: #0c5460; font-size: 0.9rem;">
                {{ 'parcours.qr_print_info'|trans }}
            </p>
        </div>
        
        <div style="text-align: right; margin-bottom: 1rem;">
            <button class="btn btn-primary" id="downloadAllQRBtn" onclick="downloadAllQRCodes()">üì• {{ 'parcours.download_all_qr'|trans }}</button>
        </div>
        <div id="qrCodesContent" class="qr-codes-grid">
            {% if course.beacons|length > 0 %}
                {% for beacon in course.beacons %}
                    {% include 'courses_orienteering/tiles/qr.html.twig' with { 'course': course } %}
                {% endfor %}
            {% endif %}
        </div>
    </div>

        {% block javascripts %}
        
        
        <!-- Load libraries from local assets (no CDN needed) -->
        <script src="{{ asset('assets/js/qrcode.min.js') }}" onload="window.qrCodeLibraryLoaded = true; console.log('QRCode library loaded from local assets');"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" data-turbo-track="reload" async onload="window.jspdfLibraryLoaded = true; console.log('jsPDF library loaded');"></script>
        
    {% endblock %}
        <script> 
            const beaconsQr=document.getElementsByClassName("js-qrcode");
            for (beaconQr of beaconsQr){
                new QRCode(document.getElementById(beaconQr.id), {
                    text:beaconQr.title,
                    width:150,
                    height:150});
            }
        </script>
{% endblock %}